<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fio Certo</title>
<style>
:root{
  --bg:#f3f6fb; --card:#ffffff; --muted:#6b7280; --accent:#0ea5a3; --accent-darker:#0b8f8c;
  --btn:#0369a1; --success:#10b981; --danger:#ef4444; --radius:12px; --glass: rgba(255,255,255,0.7);
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Arial,sans-serif;background:linear-gradient(180deg,#e6eef7,var(--bg));color:#0f172a;}
.container{max-width:980px;margin:28px auto;padding:20px;}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px;}
.title{display:flex;gap:12px;align-items:center;}
.logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-darker));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;}
h1{font-size:20px;margin:0} .subtitle{color:var(--muted);font-size:13px;}
.grid{display:grid;grid-template-columns: 1fr 420px;gap:18px;}
.card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow: 0 6px 20px rgba(15,23,42,0.06);}
label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
select,input{width:100%;padding:10px 12px;margin-top:6px;border-radius:10px;border:1px solid #e6eef7;background:var(--glass);font-size:14px;}
.row{display:flex;gap:10px;align-items:center;margin-top:12px}
.btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600;}
.btn-primary{background:var(--btn);color:white;box-shadow:0 8px 18px rgba(3,105,161,0.12)}
.btn-primary:hover{background:#054b73}
.btn-sec{background:#fff;border:1px solid #e6eef7}
.btn-green{background:var(--success);color:white}
.small{font-size:13px;color:var(--muted);}
.resultTitle{font-weight:700;margin:0 0 6px 0}
.resultBox{background:#07122a;color:#e6fffb;padding:14px;border-radius:10px;white-space:pre-wrap;font-family:monospace}
#overlay{display:none;position:fixed;inset:0;background:rgba(2,6,23,0.45);z-index:60}
#modal{display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:460px;max-width:94%;z-index:70;border-radius:12px;padding:18px;background:var(--card);box-shadow:0 20px 60px rgba(2,6,23,0.25);max-height:86vh;overflow:auto}
.modalHeader{display:flex;justify-content:space-between;align-items:center}
.modalClose{background:transparent;border:none;color:var(--muted);font-weight:700;cursor:pointer}
.note{font-size:13px;color:var(--muted);margin-top:6px}
@media (max-width:900px){.grid{grid-template-columns:1fr; }.title h1{font-size:18px}}
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="title">
      <div class="logo">FC</div>
      <div>
        <h1>Fio Certo</h1>
        <div class="subtitle">Padrões de cores e locais para instalação</div>
      </div>
    </div>
    <div>
      <button class="btn btn-primary" onclick="abrirCadastro()">Cadastrar</button>
      <button class="btn btn-sec" onclick="abrirEditar()">Editar Veículos</button>
    </div>
  </div>

  <!-- GRID PRINCIPAL -->
  <div class="grid" id="gridPrincipal">
    <!-- BUSCA -->
    <div class="card">
      <label>Tipo do veículo</label>
      <select id="tipoSelect">
        <option value="">-- selecione --</option>
        <option value="carro">Carro</option>
        <option value="moto">Moto</option>
        <option value="caminhao">Caminhão</option>
      </select>

      <div id="marcaWrap" style="display:none">
        <label>Marca</label>
        <select id="marcaSelect"><option value="">-- selecione --</option></select>
      </div>

      <div id="modeloWrap" style="display:none">
        <label>Modelo</label>
        <select id="modeloSelect"><option value="">-- selecione --</option></select>
      </div>

      <div id="subWrap" style="display:none">
        <label>Submodelo</label>
        <select id="submodeloSelect"><option value="">-- selecione --</option></select>
      </div>

      <div id="anoWrap" style="display:none">
        <label>Ano</label>
        <select id="anoSelect"><option value="">-- selecione --</option></select>
      </div>

      <div class="row" style="margin-top:16px">
        <button class="btn btn-primary" onclick="buscar()">Buscar</button>
        <button class="btn btn-sec" onclick="resetBusca()">Limpar</button>
      </div>
    </div>

    <!-- RESULTADO -->
    <div class="card">
      <h3 class="resultTitle">Resultado</h3>
      <div id="resultado" class="resultBox" style="font-family:Verdana;font-size:20px;">Nenhuma busca realizada.</div>
    </div>
  </div>

  <!-- EDIÇÃO -->
  <div id="editarAba" style="display:none;">
    <div class="card">
      <div class="row" style="justify-content:flex-end;margin-bottom:8px;">
        <button class="btn btn-sec" onclick="voltarBusca()">Voltar à Busca</button>
      </div>
      <h3>Veículos cadastrados</h3>

      <label>Tipo</label>
      <select id="editTipo">
        <option value="">-- todos --</option>
        <option value="carro">Carro</option>
        <option value="moto">Moto</option>
        <option value="caminhao">Caminhão</option>
      </select>

      <label>Marca</label>
      <select id="editMarca"><option value="">-- todos --</option></select>

      <label>Modelo</label>
      <select id="editModelo"><option value="">-- todos --</option></select>

      <label>Submodelo</label>
      <select id="editSub"><option value="">-- todos --</option></select>

      <label>Ano</label>
      <select id="editAno"><option value="">-- todos --</option></select>

      <button class="btn btn-primary" style="margin-top:8px;" onclick="filtrarEdicao()">Filtrar</button>

      <div id="listaVeiculos" style="margin-top:12px;"></div>
    </div>
  </div>

</div>

<!-- MODAL -->
<div id="overlay"></div>
<div id="modal">
  <div class="modalHeader">
    <strong id="modalTitle">Cadastrar veículo</strong>
    <button class="modalClose" onclick="fecharModal()">X</button>
  </div>

  <p class="note">Preencha os campos e clique em salvar. Dados ficam salvos no navegador.</p>

  <label>Tipo</label>
  <select id="addTipo">
    <option value="carro">Carro</option>
    <option value="moto">Moto</option>
    <option value="caminhao">Caminhão</option>
  </select>

  <label>Marca</label>
  <select id="addMarca"></select>

  <label>Modelo</label>
  <input id="addModelo">

  <label>Submodelo</label>
  <input id="addSubmodelo">

  <label>Ano</label>
  <input id="addAno" type="number">

  <label>Local de instalação</label>
  <input id="addLocal">
  <label>Positivo</label><input id="addPositivo">
  <label>Negativo</label><input id="addNegativo">
  <label>Pós-chave</label><input id="addPosChave">
  <label>Bloqueio</label><input id="addBloqueio">

  <div class="row" style="justify-content:flex-end;margin-top:14px">
    <button class="btn btn-green" id="btnSalvar">Salvar</button>
    <button class="btn btn-sec" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<script type="module" src="firebase.js"></script>
<script type="module" src="db_cloud.js"></script>

<script type="module">
import { loadCloudDB, saveCloudVehicle, updateCloudVehicle } from "./db_cloud.js";

// define window.dbCloud ANTES de tentar carregar dados
window.dbCloud = { loadCloudDB, saveCloudVehicle, updateCloudVehicle };

// agora carregamos os dados da nuvem
let userDB = [];
let db = [];

(async () => {
  userDB = await window.dbCloud.loadCloudDB();
  db = [...userDB];
})();

// --------------------------
// aqui vai todo o seu JS do HTML que você já tinha
// desde arrays de marcas, funções abrirCadastro, fecharModal, buscar, editarVeiculo, etc.
// --------------------------

</script>

</body>
</html>
