<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Veículos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 250px; padding: 5px; }
    button { margin-top: 10px; padding: 8px 20px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
  </style>
</head>
<body>

<h2>Cadastro de Veículos</h2>

<label>Placa:</label>
<input id="placa" type="text">

<label>Modelo:</label>
<input id="modelo" type="text">

<label>Cor:</label>
<input id="cor" type="text">

<button onclick="salvarVeiculo()">Salvar</button>

<h2>Veículos Cadastrados</h2>
<table>
  <thead>
    <tr>
      <th>Placa</th>
      <th>Modelo</th>
      <th>Cor</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody id="listaVeiculos"></tbody>
</table>


<!-- Firebase -->
<script type="module">
  import { initializeApp } 
  from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";

  import { 
    getDatabase, ref, set, push, onValue, update, remove 
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  // CONFIGURAÇÃO
  const firebaseConfig = {
    apiKey: "AIzaSyAINZiFRep2cG8KyorP5_bi2lSEqSFoI_Q",
    authDomain: "fio-certo.firebaseapp.com",
    databaseURL: "https://fio-certo-default-rtdb.firebaseio.com",
    projectId: "fio-certo",
    storageBucket: "fio-certo.firebasestorage.app",
    messagingSenderId: "152915023014",
    appId: "1:152915023014:web:4b5f338ec6abcc71cbd067"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // --------------------------
  // SALVAR VEÍCULO
  // --------------------------
  function salvarVeiculo() {
    const placa = document.getElementById("placa").value;
    const modelo = document.getElementById("modelo").value;
    const cor = document.getElementById("cor").value;

    if (!placa || !modelo || !cor) {
      alert("Preencha todos os campos!");
      return;
    }

    const dados = { placa, modelo, cor };

    // ID único automático
    const refNovo = push(ref(db, "veiculos"));
    set(refNovo, dados);

    document.getElementById("placa").value = "";
    document.getElementById("modelo").value = "";
    document.getElementById("cor").value = "";
  }

  // --------------------------
  // LISTAR EM TEMPO REAL
  // --------------------------
  const lista = document.getElementById("listaVeiculos");

  onValue(ref(db, "veiculos"), (snapshot) => {
    lista.innerHTML = "";

    snapshot.forEach((child) => {
      const id = child.key;
      const v = child.val();

      const row = `
        <tr>
          <td>${v.placa}</td>
          <td>${v.modelo}</td>
          <td>${v.cor}</td>
          <td>
            <button onclick="editar('${id}','${v.placa}','${v.modelo}','${v.cor}')">Editar</button>
            <button onclick="deletar('${id}')">Excluir</button>
          </td>
        </tr>
      `;

      lista.innerHTML += row;
    });
  });

  // --------------------------
  // EDITAR
  // --------------------------
  window.editar = function(id, placa, modelo, cor) {
    document.getElementById("placa").value = placa;
    document.getElementById("modelo").value = modelo;
    document.getElementById("cor").value = cor;

    const novoBotao = document.createElement("button");
    novoBotao.textContent = "Salvar Edição";
    novoBotao.onclick = function () {
      update(ref(db, "veiculos/" + id), {
        placa: document.getElementById("placa").value,
        modelo: document.getElementById("modelo").value,
        cor: document.getElementById("cor").value
      });

      novoBotao.remove();
    };

    document.body.appendChild(novoBotao);
  };

  // --------------------------
  // DELETAR
  // --------------------------
  window.deletar = function(id) {
    remove(ref(db, "veiculos/" + id));
  };
</script>

</body>
</html>
